<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D Initiative Roller</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="campaign-selector">
                <select id="campaignDropdown" class="campaign-dropdown">
                    <option value="">Loading campaigns...</option>
                </select>
            </div>
            <div class="header-center">
                <h1>üé≤ Initiative Roller <span class="round-badge">Round <span id="roundNumber">1</span></span></h1>
                <div class="header-controls">
                    <button id="rerollAll" class="btn btn-primary">üé≤ Re-roll</button>
                    <button id="nextRound" class="btn btn-secondary">Next Round</button>
                </div>
            </div>
            <button id="menuToggle" class="menu-toggle" title="Menu">‚ò∞</button>
            <div id="mobileMenu" class="mobile-menu">
                <button id="manageCampaignsBtn" class="btn btn-secondary menu-item">üéÆ Manage Campaigns</button>
                <button id="managePartyBtn" class="btn btn-secondary menu-item">üë• Manage Party</button>
                <button id="viewHistory" class="btn btn-secondary menu-item">üìú History</button>
                <button id="logoutBtn" class="btn btn-danger menu-item">üîì Logout</button>
                <div class="theme-toggle-menu">
                    <span class="theme-label">Theme:</span>
                    <button id="lightTheme" class="theme-btn">‚òÄÔ∏è</button>
                    <button id="darkTheme" class="theme-btn active">üåô</button>
                </div>
            </div>
        </header>

        <div class="initiative-list">
            <!-- <h2>Initiative Order</h2> -->
            <div id="initiativeOrder" class="order-container">
                <p class="empty-state">Add combatants to start rolling initiative!</p>
            </div>
        </div>

        <div class="add-combatant">
            <h3>Add Enemy</h3>
            <form id="addCombatantForm">
                <div class="form-row">
                    <div class="form-field">
                        <label for="combatantName">Name</label>
                        <input type="text" id="combatantName" placeholder="Enemy Name" required>
                    </div>
                    <div class="form-field">
                        <label for="combatantDex">Dexterity</label>
                        <input type="number" id="combatantDex" placeholder="0" value="0" required>
                    </div>
                    <div class="form-field">
                        <label for="combatantModifier">Modifier</label>
                        <input type="number" id="combatantModifier" placeholder="0" value="0" required>
                    </div>
                    <div class="form-field">
                        <label for="combatantAdvantage">Roll Type</label>
                        <select id="combatantAdvantage">
                            <option value="normal">Normal</option>
                            <option value="advantage">Advantage</option>
                            <option value="disadvantage">Disadvantage</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-success">Add</button>
                </div>
            </form>
        </div>

        <div class="combatants-manager">
            <div class="combatants-section combatants-section-full">
                <h3>Enemies</h3>
                <div id="enemyList" class="combatant-list">
                    <p class="empty-state-small">No enemies added</p>
                </div>
            </div>
        </div>

        <div class="actions">
            <button id="clearAll" class="btn btn-danger">Clear Enemies</button>
            <button id="resetRound" class="btn btn-secondary">Reset to Round 1</button>
        </div>
    </div>

    <!-- Password Modal -->
    <div id="passwordModal" class="modal modal-no-close" style="display: none;">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>üîí Authentication Required</h2>
            </div>
            <div class="modal-body">
                <form id="passwordForm">
                    <div class="form-group">
                        <label for="passwordInput">Enter Password:</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="passwordInput" placeholder="Password" required autofocus>
                            <button type="button" id="togglePasswordBtn" class="toggle-password-btn" title="Show password">Show</button>
                        </div>
                    </div>
                    <div class="form-group remember-me">
                        <label>
                            <input type="checkbox" id="rememberMe" checked>
                            <span>Remember me on this device</span>
                        </label>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Unlock</button>
                    </div>
                    <p id="passwordError" class="password-error"></p>
                </form>
            </div>
        </div>
    </div>

    <!-- Manage Party Modal -->
    <div id="managePartyModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Manage Party <span id="managePartyCampaignName" class="modal-subtitle"></span></h2>
                <button class="modal-close" onclick="closeManagePartyModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="add-combatant-inline">
                    <button id="openAddPartyDialogBtn" class="btn btn-success">‚ûï Add Party / Ally</button>
                </div>

                <div class="combatants-manager manage-party-modal">
                    <div class="combatants-section">
                        <h4>Party</h4>
                        <div id="partyList" class="combatant-list">
                            <p class="empty-state-small">No party added</p>
                        </div>
                    </div>

                    <div class="combatants-section">
                        <h4>Allies</h4>
                        <div id="friendlyList" class="combatant-list">
                            <p class="empty-state-small">No allies added</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Campaign Management Modal -->
    <div id="campaignModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Manage Campaigns</h2>
                <button class="modal-close" onclick="closeCampaignModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="campaign-form">
                    <h3>Create New Campaign</h3>
                    <form id="createCampaignForm">
                        <input type="text" id="newCampaignName" placeholder="Campaign Name (e.g., Curse of Strahd)" required>
                        <button type="submit" class="btn btn-success">Create Campaign</button>
                    </form>
                </div>
                <div class="campaign-list-section">
                    <h3>Your Campaigns</h3>
                    <div id="campaignList" class="campaign-list">
                        <p class="empty-state-small">Loading campaigns...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Campaign Modal -->
    <div id="editCampaignModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Rename Campaign</h2>
                <button class="modal-close" onclick="closeEditCampaignModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="editCampaignForm">
                    <input type="hidden" id="editCampaignId">
                    <input type="text" id="editCampaignName" placeholder="Campaign Name" required>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Add/Edit Party Member Modal -->
    <div id="addEditPartyModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="addEditPartyTitle">Add Party / Ally</h2>
                <button class="modal-close" onclick="closeAddEditPartyModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="addEditPartyForm">
                    <input type="hidden" id="editPartyId">
                    <div class="form-group">
                        <label for="partyMemberName">Name:</label>
                        <input type="text" id="partyMemberName" placeholder="Character Name" required>
                    </div>
                    <div class="form-group">
                        <label for="partyMemberDex">Dexterity:</label>
                        <input type="number" id="partyMemberDex" placeholder="e.g., 3" value="0" required>
                    </div>
                    <div class="form-group">
                        <label for="partyMemberModifier">Modifier:</label>
                        <input type="number" id="partyMemberModifier" placeholder="e.g., 4" value="0" required>
                    </div>
                    <div class="form-group">
                        <label for="partyMemberType">Type:</label>
                        <select id="partyMemberType">
                            <option value="party">Party Member</option>
                            <option value="friendly">Ally</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="partyMemberAdvantage">Initiative Roll:</label>
                        <select id="partyMemberAdvantage">
                            <option value="normal">Normal</option>
                            <option value="advantage">Advantage</option>
                            <option value="disadvantage">Disadvantage</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary" id="savePartyMemberBtn">Save</button>
                        <button type="button" class="btn btn-secondary" onclick="closeAddEditPartyModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Initiative History</h2>
                <button class="modal-close" onclick="closeHistoryModal()">√ó</button>
            </div>
            <div id="historyContent" class="modal-body">
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, onValue, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDfZqVNgz3bGNi2vaxiw6EpgGMiH9Ieo1Y",
            authDomain: "dnd-initiative-roller.firebaseapp.com",
            databaseURL: "https://dnd-initiative-roller-default-rtdb.firebaseio.com",
            projectId: "dnd-initiative-roller",
            storageBucket: "dnd-initiative-roller.firebasestorage.app",
            messagingSenderId: "1041034788288",
            appId: "1:1041034788288:web:c8fbfa7939d6e766281c25"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);

        // Make Firebase available globally
        window.firebaseDB = database;
        window.firebaseAuth = auth;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseOnValue = onValue;
        window.firebaseUpdate = update;
        window.firebaseSignInAnonymously = signInAnonymously;
        window.firebaseOnAuthStateChanged = onAuthStateChanged;
        
        // Signal that Firebase is ready
        window.firebaseReady = true;
        console.log('Firebase initialized successfully');
    </script>
    <script src="app.js"></script>
</body>
</html>
